# Environment Setup & Configuration Guide\n\nThis guide covers the comprehensive environment separation system for the AI Model Validation Platform, ensuring bulletproof deployment across development, production, and local scenarios.\n\n## üéØ Overview\n\nThe platform now features:\n- **Automatic environment detection**\n- **Smart URL generation with fallbacks**\n- **Runtime configuration validation**\n- **Cross-environment video handling**\n- **Real-time connectivity monitoring**\n\n## üìÅ Environment Files Structure\n\n```\nfrontend/\n‚îú‚îÄ‚îÄ .env                     # Base configuration (fallback)\n‚îú‚îÄ‚îÄ .env.development         # Development environment\n‚îú‚îÄ‚îÄ .env.production         # Production environment  \n‚îú‚îÄ‚îÄ .env.local              # Local overrides (git-ignored)\n‚îî‚îÄ‚îÄ .env.local.example      # Template for local config\n```\n\n### File Priority Order\n1. `.env.local` (highest priority, git-ignored)\n2. `.env.development` or `.env.production` (based on NODE_ENV)\n3. `.env` (lowest priority, fallback)\n\n## ‚öôÔ∏è Environment Configuration\n\n### Development Environment (.env.development)\n\n```bash\n# Development Environment Configuration\n# This file is used when NODE_ENV=development (npm start)\n\n# API Configuration\nREACT_APP_API_URL=http://localhost:8000\nREACT_APP_WS_URL=ws://localhost:8000\nREACT_APP_SOCKETIO_URL=http://localhost:8001\n\n# Environment Settings\nREACT_APP_ENVIRONMENT=development\nREACT_APP_DEBUG=true\nREACT_APP_LOG_LEVEL=debug\n\n# Feature Flags\nREACT_APP_ENABLE_MOCK_DATA=false\nREACT_APP_ENABLE_DEBUG_PANELS=true\nREACT_APP_ENABLE_PERFORMANCE_MONITORING=true\n\n# Video Configuration\nREACT_APP_VIDEO_BASE_URL=http://localhost:8000\nREACT_APP_MAX_VIDEO_SIZE_MB=100\nREACT_APP_SUPPORTED_VIDEO_FORMATS=mp4,avi,mov,mkv\n\n# Timeouts (in milliseconds)\nREACT_APP_API_TIMEOUT=30000\nREACT_APP_WS_TIMEOUT=20000\nREACT_APP_CONNECTION_RETRY_ATTEMPTS=5\nREACT_APP_CONNECTION_RETRY_DELAY=1000\n```\n\n### Production Environment (.env.production)\n\n```bash\n# Production Environment Configuration\n# This file is used when NODE_ENV=production (npm run build)\n# Server IP: 155.138.239.131\n\n# API Configuration\nREACT_APP_API_URL=http://155.138.239.131:8000\nREACT_APP_WS_URL=ws://155.138.239.131:8000\nREACT_APP_SOCKETIO_URL=http://155.138.239.131:8001\n\n# Environment Settings\nREACT_APP_ENVIRONMENT=production\nREACT_APP_DEBUG=false\nREACT_APP_LOG_LEVEL=error\n\n# Feature Flags\nREACT_APP_ENABLE_MOCK_DATA=false\nREACT_APP_ENABLE_DEBUG_PANELS=false\nREACT_APP_ENABLE_PERFORMANCE_MONITORING=true\n\n# Video Configuration\nREACT_APP_VIDEO_BASE_URL=http://155.138.239.131:8000\nREACT_APP_MAX_VIDEO_SIZE_MB=500\nREACT_APP_SUPPORTED_VIDEO_FORMATS=mp4,avi,mov,mkv\n\n# Timeouts (in milliseconds) - More lenient for production\nREACT_APP_API_TIMEOUT=45000\nREACT_APP_WS_TIMEOUT=30000\nREACT_APP_CONNECTION_RETRY_ATTEMPTS=10\nREACT_APP_CONNECTION_RETRY_DELAY=2000\n\n# Security Headers\nREACT_APP_SECURE_COOKIES=true\n```\n\n### Local Overrides (.env.local)\n\nCopy `.env.local.example` to `.env.local` and customize:\n\n```bash\n# Local Override Configuration\n# This file takes precedence over all other environment files\n# Never commit this file to version control!\n\n# Custom API Configuration\nREACT_APP_API_URL=http://192.168.1.100:8000\nREACT_APP_WS_URL=ws://192.168.1.100:8000\nREACT_APP_SOCKETIO_URL=http://192.168.1.100:8001\n\n# Custom Debug Settings\nREACT_APP_DEBUG=true\nREACT_APP_LOG_LEVEL=debug\n\n# Custom Port\nPORT=3001\n```\n\n## üöÄ Quick Setup\n\n### For Development\n\n```bash\n# 1. Clone the repository\ngit clone <repository-url>\ncd ai-model-validation-platform\n\n# 2. Install dependencies\nnpm install\n\n# 3. Start development server\nnpm start\n\n# The system will automatically:\n# - Detect development environment\n# - Use localhost:8000 for API\n# - Enable debug logging\n# - Show configuration validator\n```\n\n### For Production (155.138.239.131)\n\n```bash\n# 1. Build for production\nNODE_ENV=production npm run build\n\n# 2. Serve the built files\nnpx serve -s build -p 3000\n\n# The system will automatically:\n# - Detect production environment\n# - Use 155.138.239.131:8000 for API\n# - Disable debug features\n# - Enable production optimizations\n```\n\n### For Custom Environment\n\n```bash\n# 1. Create .env.local with your settings\ncp .env.local.example .env.local\n# Edit .env.local with your custom URLs\n\n# 2. Start normally\nnpm start\n```\n\n## üîß Configuration Management\n\n### Environment Detection\n\nThe system automatically detects the environment using:\n\n1. **Explicit Override**: `REACT_APP_ENVIRONMENT` variable\n2. **NODE_ENV**: Maps `development`, `production`, `test`\n3. **Smart Defaults**: Based on hostname and context\n\n### URL Generation\n\nURLs are generated intelligently:\n\n```typescript\n// API URLs\nif (hostname === 'localhost') ‚Üí 'http://localhost:8000'\nif (hostname === '155.138.239.131') ‚Üí 'http://155.138.239.131:8000'\nelse ‚Üí `${protocol}//${hostname}:8000`\n\n// WebSocket URLs\napi.replace('http://', 'ws://').replace('https://', 'wss://')\n\n// Video URLs\nsame as API with fallback mechanisms\n```\n\n### Configuration Validation\n\nThe system validates:\n- ‚úÖ **URL Format**: All URLs are properly formed\n- ‚úÖ **Timeout Values**: Reasonable timeout settings\n- ‚úÖ **Retry Configuration**: Valid retry attempts and delays\n- ‚úÖ **Video Settings**: File size and format limits\n- ‚úÖ **Feature Flags**: Boolean values and dependencies\n\n## üîç Runtime Monitoring\n\n### Configuration Validator Component\n\nAdd to your app for real-time monitoring:\n\n```tsx\nimport ConfigurationValidator from './components/ConfigurationValidator';\n\nfunction App() {\n  return (\n    <div>\n      {/* Your app content */}\n      \n      {/* Add configuration validator */}\n      <ConfigurationValidator \n        showDetails={true}\n        autoRefresh={true}\n        refreshInterval={30000}\n        onValidationChange={(isValid, errors) => {\n          if (!isValid) {\n            console.error('Configuration issues:', errors);\n          }\n        }}\n      />\n    </div>\n  );\n}\n```\n\n### Manual Testing\n\nTest connectivity programmatically:\n\n```typescript\nimport envConfig from './utils/envConfig';\nimport { apiService } from './services/api';\n\n// Test API connectivity\nconst testApi = async () => {\n  const result = await envConfig.testApiConnectivity();\n  console.log('API Test:', result);\n};\n\n// Get configuration info\nconst config = envConfig.getConfig();\nconsole.log('Current Config:', config);\n\n// Get service-specific config\nconst apiConfig = envConfig.getServiceConfig('api');\nconsole.log('API Config:', apiConfig);\n```\n\n## üé• Video Handling\n\n### Smart Video URLs\n\nThe system handles video URLs intelligently:\n\n```typescript\nimport { generateVideoUrl, getFallbackVideoUrl } from './utils/videoUtils';\n\n// Generate environment-aware video URL\nconst videoUrl = generateVideoUrl({\n  id: 'video-123',\n  filename: 'sample.mp4'\n}, { quality: 'high' });\n\n// Get URL with fallbacks\nconst fallbackUrl = await getFallbackVideoUrl({\n  id: 'video-123',\n  filename: 'sample.mp4'\n});\n```\n\n### Video URL Fallback Chain\n\n1. **Primary URL**: Original video.url if available\n2. **Generated URL**: Environment-specific URL generation\n3. **Quality Fallback**: Medium ‚Üí Low quality\n4. **Direct Access**: Direct filename and ID attempts\n5. **Error Handling**: Clear error messages if all fail\n\n## üîí Security Considerations\n\n### Environment File Security\n\n- ‚úÖ `.env.local` is git-ignored (contains sensitive local config)\n- ‚úÖ `.env.development` and `.env.production` are tracked (no secrets)\n- ‚úÖ Production uses secure cookie settings when available\n- ‚úÖ Debug features disabled in production\n\n### Network Security\n\n- üîÑ **HTTP Only**: Current setup uses HTTP (upgrade to HTTPS for production)\n- ‚úÖ **CORS Handling**: Backend should configure CORS properly\n- ‚úÖ **Timeout Protection**: Prevents hanging requests\n- ‚úÖ **Retry Limits**: Prevents infinite retry loops\n\n## üìä Performance Optimizations\n\n### Caching Strategy\n\n- **API Responses**: GET requests cached with intelligent invalidation\n- **Video URLs**: Generated URLs cached with TTL\n- **Configuration**: Environment config cached after initial load\n- **Connectivity**: Connection status cached to avoid repeated tests\n\n### Network Optimizations\n\n- **Request Deduplication**: Prevents duplicate API calls\n- **Connection Pooling**: WebSocket connections reused when possible\n- **Timeout Management**: Environment-specific timeouts\n- **Fallback Mechanisms**: Multiple fallback strategies\n\n## üêõ Troubleshooting\n\n### Common Issues\n\n#### \"API connection failed\"\n\n**Symptoms**: Cannot connect to backend API\n\n**Solutions**:\n1. Check if backend server is running: `curl http://localhost:8000/health`\n2. Verify API URL in environment config\n3. Check firewall/proxy settings\n4. Review network connectivity\n\n```bash\n# Test API connectivity\ncurl -v http://localhost:8000/health\n# Should return: {\"status\": \"ok\"}\n```\n\n#### \"Video URL not loading\"\n\n**Symptoms**: Videos show loading spinner indefinitely\n\n**Solutions**:\n1. Check video files exist in backend uploads directory\n2. Verify video URL generation in browser console\n3. Test video URL directly: `http://localhost:8000/uploads/video-id.mp4`\n4. Check video format support\n\n```typescript\n// Debug video URL generation\nimport { generateVideoUrl } from './utils/videoUtils';\nconst url = generateVideoUrl({ id: 'test', filename: 'test.mp4' });\nconsole.log('Generated URL:', url);\n```\n\n#### \"WebSocket connection failed\"\n\n**Symptoms**: Real-time features not working\n\n**Solutions**:\n1. Check if Socket.IO server is running on port 8001\n2. Verify WebSocket URL configuration\n3. Check for proxy/firewall blocking WebSocket connections\n4. Review CORS settings for WebSocket\n\n```bash\n# Test WebSocket server\ncurl http://localhost:8001/socket.io/\n# Should return Socket.IO response\n```\n\n#### \"Configuration validation errors\"\n\n**Symptoms**: Red status in Configuration Validator\n\n**Solutions**:\n1. Check environment file syntax\n2. Verify all required variables are set\n3. Ensure URLs are properly formatted\n4. Check timeout values are reasonable\n\n### Debug Mode\n\nEnable detailed logging:\n\n```bash\n# In .env.local or .env.development\nREACT_APP_DEBUG=true\nREACT_APP_LOG_LEVEL=debug\nREACT_APP_ENABLE_DEBUG_PANELS=true\n```\n\nThis enables:\n- üìù Detailed console logging\n- üîß Configuration validator details\n- üåê Network request/response logging\n- üé• Video URL generation logging\n- üìä Performance monitoring\n\n### Health Checks\n\nUse the built-in health check endpoints:\n\n```bash\n# Frontend configuration status\nGET http://localhost:3000/ # Check Configuration Validator\n\n# Backend API health\nGET http://localhost:8000/health\n\n# Socket.IO server health\nGET http://localhost:8001/socket.io/\n```\n\n## üîÑ Migration from Old System\n\nIf upgrading from the previous mixed localhost/155.138.239.131 setup:\n\n1. **Backup existing .env files**\n2. **Update to new environment structure**\n3. **Test in development first**\n4. **Validate configuration**\n5. **Deploy to production**\n\n```bash\n# Backup old config\ncp .env .env.backup\n\n# Update to new structure\ncp .env.development.example .env.development\n# Edit with your settings\n\n# Test configuration\nnpm start\n# Check Configuration Validator\n\n# Deploy when ready\nNODE_ENV=production npm run build\n```\n\n## üìù Best Practices\n\n### Development Workflow\n\n1. **Use .env.development** for team-shared development settings\n2. **Use .env.local** for personal overrides (git-ignored)\n3. **Test configuration changes** with Configuration Validator\n4. **Monitor console** for debug information\n5. **Validate before committing** environment changes\n\n### Production Deployment\n\n1. **Test production build** locally first\n2. **Verify all URLs** point to production servers\n3. **Check connectivity** from production network\n4. **Monitor Configuration Validator** after deployment\n5. **Have rollback plan** ready\n\n### Configuration Management\n\n1. **Keep secrets out** of tracked .env files\n2. **Use meaningful variable names**\n3. **Document configuration changes**\n4. **Test fallback scenarios**\n5. **Monitor performance impact**\n\n## üìû Support\n\nFor issues with environment configuration:\n\n1. **Check this documentation** first\n2. **Enable debug mode** for detailed logging\n3. **Use Configuration Validator** for real-time status\n4. **Test individual components** (API, WebSocket, Video)\n5. **Review troubleshooting section**\n\n---\n\n**üéØ Remember**: This system is designed to be bulletproof across all deployment scenarios. When properly configured, it should work seamlessly in development, production, and any custom environment.